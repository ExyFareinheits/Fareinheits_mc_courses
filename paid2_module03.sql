-- =====================================================
-- –ú–û–î–£–õ–¨ 1, –£–†–û–ö 2: Spark —Ç–∞ Timings - –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –ø—Ä–æ—Ñ–∞–π–ª—ñ–Ω–≥
-- =====================================================
-- –ö—É—Ä—Å: paid-2 (–Ü–¥–µ–∞–ª—å–Ω–∞ –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è Minecraft –°–µ—Ä–≤–µ—Ä–∞)

DO $$
DECLARE
  v_module_id TEXT;
  v_lesson_id TEXT;
BEGIN
  -- –ó–Ω–∞—Ö–æ–¥–∏–º–æ Module 1
  SELECT id::text INTO v_module_id 
  FROM course_modules 
  WHERE course_id = 'paid-2' AND order_index = 1;
  
  v_lesson_id := gen_random_uuid()::text;
  
  -- –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä–∏–π —É—Ä–æ–∫ 2 —è–∫—â–æ —î
  DELETE FROM course_lessons 
  WHERE module_id = v_module_id AND order_index = 2;
  
  INSERT INTO course_lessons (
    course_id, module_id, lesson_id, title, type, content, duration, order_index, is_free_preview
  ) VALUES (
    'paid-2',
    v_module_id,
    v_lesson_id,
    'Spark Profiler: –∑–Ω–∞—Ö–æ–¥–∏–º–æ –ø—Ä–æ–±–ª–µ–º–∏',
    'text',
    '# Spark Profiler: –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üéØ –ß–æ–º—É Spark - ‚Ññ1 —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

**Spark** - —Ü–µ –Ω–∞–π–ø–æ—Ç—É–∂–Ω—ñ—à–∏–π –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –ø—Ä–æ—Ñ–∞–π–ª–µ—Ä –¥–ª—è Minecraft. –í—ñ–Ω –ø–æ–∫–∞–∂–µ:
- –Ø–∫—ñ –ø–ª–∞–≥—ñ–Ω–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å —Å–µ—Ä–≤–µ—Ä
- –Ø–∫—ñ –º–µ—Ç–æ–¥–∏ –∑–∞–π–º–∞—é—Ç—å –Ω–∞–π–±—ñ–ª—å—à–µ —á–∞—Å—É
- –î–µ –≤–∏—Ç—Ä–∞—á–∞—î—Ç—å—Å—è –∫–æ–∂–Ω–∞ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞ —Ç—ñ–∫—É
- –ü—Ä–æ–±–ª–µ–º–∏ –∑ –ø–∞–º—è—Ç—Ç—é —Ç–∞ GC

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏ (–≥—ñ—Ä—à—ñ):**
- ‚ùå Timings - –∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π, –º–µ–Ω—à —Ç–æ—á–Ω–∏–π
- ‚ùå VisualVM - —Å–∫–ª–∞–¥–Ω–∏–π, –Ω–µ –¥–ª—è Minecraft
- ‚ùå JProfiler - –ø–ª–∞—Ç–Ω–∏–π
- ‚úÖ **Spark - –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π, —Ç–æ—á–Ω–∏–π, —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ –¥–ª—è MC**

## üì• –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Spark

### –ö—Ä–æ–∫ 1: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø–∞–ø–∫—É plugins
cd /path/to/server/plugins/

# –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –æ—Å—Ç–∞–Ω–Ω—é –≤–µ—Ä—Å—ñ—é
wget https://ci.lucko.me/job/spark/lastSuccessfulBuild/artifact/spark-bukkit/build/libs/spark-bukkit.jar

# –ê–±–æ –¥–ª—è Paper
wget https://download.luckperms.net/1516/bukkit/loader/spark-Bukkit-1.10.53.jar
```

### –ö—Ä–æ–∫ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
/stop

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ Spark –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è
/plugins
# –ú–∞—î –±—É—Ç–∏ –∑–µ–ª–µ–Ω–∏–π: [Spark v1.10.x]
```

### –ö—Ä–æ–∫ 3: –ü–µ—Ä—à–∏–π –∑–∞–ø—É—Å–∫

```bash
/spark
# –ü–æ–±–∞—á–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥

/spark tps
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ TPS –∑ –≥—Ä–∞—Ñ—ñ–∫–∞–º–∏
```

## üîç –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ Spark

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ TPS (—à–≤–∏–¥–∫–æ)

```bash
/spark tps

# –í–∏–≤—ñ–¥:
TPS (1m, 5m, 15m): 20.00, 19.83, 19.67
CPU: 15.3%
Uptime: 2h 34m
```

**–Ø–∫ —á–∏—Ç–∞—Ç–∏:**
- 20.00 = TPS –æ—Å—Ç–∞–Ω–Ω—é —Ö–≤–∏–ª–∏–Ω—É
- 19.83 = TPS –æ—Å—Ç–∞–Ω–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω (–ø–∞–¥–∞—î!)
- CPU 15% = –Ω–æ—Ä–º–∞–ª—å–Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- CPU >80% = –ø—Ä–æ–±–ª–µ–º–∞!

### 2. Health Report (–∑–∞–≥–∞–ª—å–Ω–∏–π –æ–≥–ª—è–¥)

```bash
/spark healthreport

# –ì–µ–Ω–µ—Ä—É—î –∑–≤—ñ—Ç –∑–∞ 10 —Å–µ–∫—É–Ω–¥ —ñ –¥–∞—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è
```

**–©–æ –ø–æ–∫–∞–∂–µ:**
- ‚úÖ –°–µ—Ä–µ–¥–Ω—ñ–π TPS
- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è CPU
- ‚úÖ –ü–∞–º—è—Ç—å (heap usage)
- ‚úÖ –ù–∞–π–≥—ñ—Ä—à—ñ —Ç—ñ–∫–∏
- ‚úÖ –ü—Ä–æ–±–ª–µ–º–Ω—ñ –ø–ª–∞–≥—ñ–Ω–∏

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**
- –©–æ–¥–Ω—è –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É
- –ö–æ–ª–∏ TPS <19.5
- –ü–µ—Ä–µ–¥ —Ç–∞ –ø—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### 3. Profiler (–≥–ª–∏–±–æ–∫–∏–π –∞–Ω–∞–ª—ñ–∑) ‚≠ê

```bash
# –ü–æ—á–∞—Ç–∏ –∑–∞–ø–∏—Å (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º 300 —Å–µ–∫ = 5 —Ö–≤)
/spark profiler

# –ê–±–æ –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
/spark profiler --timeout 600
# –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ 10 —Ö–≤–∏–ª–∏–Ω

/spark profiler --interval 10
# –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—ñ 10 —Ç—ñ–∫—ñ–≤ (–¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ)

# –ó—É–ø–∏–Ω–∏—Ç–∏ —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–≤—ñ—Ç
/spark profiler --stop
```

**–í–ê–ñ–õ–ò–í–û:**
- –ó–∞–ø–∏—Å—É–π—Ç–µ –º—ñ–Ω—ñ–º—É–º 2-3 —Ö–≤–∏–ª–∏–Ω–∏
- –†–æ–±—ñ—Ç—å –ø—ñ–¥ –ù–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø–ú (–≥—Ä–∞–≤—Ü—ñ –æ–Ω–ª–∞–π–Ω)
- –ù–ï —Ä–æ–±—ñ—Ç—å –∫–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–æ—Ä–æ–∂–Ω—ñ–π
- –†–æ–±—ñ—Ç—å –ø—ñ–¥ —á–∞—Å –ª–∞–≥—ñ–≤ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

## üìä –Ø–∫ —á–∏—Ç–∞—Ç–∏ Spark –∑–≤—ñ—Ç

### –ü—Ä–∏–∫–ª–∞–¥ –∑–≤—ñ—Ç—É (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –ø—ñ—Å–ª—è /spark profiler --stop):

```
https://spark.lucko.me/abcd1234
```

–í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —ñ –±–∞—á–∏–º–æ:

### –†–æ–∑–¥—ñ–ª 1: Overview (–æ–≥–ª—è–¥)

```
Total time: 300 seconds
TPS: 18.3 average
CPU Usage: 87%
Samples: 60,000
```

**–ê–Ω–∞–ª—ñ–∑:**
- TPS 18.3 = —î –ø—Ä–æ–±–ª–µ–º–∏ ‚ùå
- CPU 87% = –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ‚ö†Ô∏è
- 60k samples = –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö ‚úÖ

### –†–æ–∑–¥—ñ–ª 2: Call Tree (–¥–µ—Ä–µ–≤–æ –≤–∏–∫–ª–∏–∫—ñ–≤)

```
net.minecraft.server - 82.3% (41,460ms)
‚îú‚îÄ Entity Tick - 45.2% (22,730ms)
‚îÇ  ‚îú‚îÄ minecraft:cow - 18.7% (4,251ms)  ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
‚îÇ  ‚îú‚îÄ minecraft:zombie - 12.3% (2,798ms)
‚îÇ  ‚îî‚îÄ minecraft:item - 8.9% (2,023ms)
‚îú‚îÄ Chunk Tick - 22.1% (11,100ms)
‚îÇ  ‚îî‚îÄ Random Tick - 15.6% (7,831ms)
‚îî‚îÄ Tile Entity - 10.4% (5,227ms)

com.example.MyPlugin - 12.5% (6,280ms)  ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
‚îú‚îÄ PlayerMoveEvent - 8.7% (4,372ms)  ‚Üê –¢–£–¢ –õ–ê–ì!
‚îî‚îÄ onEntityDeath - 3.8% (1,908ms)
```

**–Ø–∫ —á–∏—Ç–∞—Ç–∏:**
- **–í—ñ–¥—Å–æ—Ç–∫–∏** = —á–∞—Å—Ç–∫–∞ —á–∞—Å—É —Ç—ñ–∫—É
- **–ú—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∏** = –∞–±—Å–æ–ª—é—Ç–Ω–∏–π —á–∞—Å
- ‚ùå –ë—É–¥—å-—â–æ >15% = –ø—Ä–æ–±–ª–µ–º–∞
- üîç –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –¥–µ—Ä–µ–≤–æ ‚Üí –∑–Ω–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –º–µ—Ç–æ–¥

**–ü—Ä–∏–∫–ª–∞–¥ –∞–Ω–∞–ª—ñ–∑—É:**

```
Entity Tick 45.2% - –ö–†–ò–¢–ò–ß–ù–û!
‚îî‚îÄ minecraft:cow 18.7%
   
–†—ñ—à–µ–Ω–Ω—è:
1. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ /paper entity list
2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ FarmLimiter
3. –ó–º–µ–Ω—à–∏—Ç–∏ entity-activation-range
```

```
MyPlugin::PlayerMoveEvent 8.7% - –î–£–ñ–ï –ë–ê–ì–ê–¢–û!

–†—ñ—à–µ–Ω–Ω—è:
1. –í—ñ–¥–∫—Ä–∏—Ç–∏ –∫–æ–¥ –ø–ª–∞–≥—ñ–Ω—É
2. –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É —Ä—É—Ö—É
3. –î–æ–¥–∞—Ç–∏ cooldown –º—ñ–∂ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞–º–∏
4. –ê–±–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –ø–ª–∞–≥—ñ–Ω
```

### –†–æ–∑–¥—ñ–ª 3: Flat Profile (–ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫)

–ü–æ–∫–∞–∑—É—î –¢–û–ü –º–µ—Ç–æ–¥—ñ–≤ —â–æ –∑–∞–π–º–∞—é—Ç—å —á–∞—Å:

```
1. EntityCow.tick() - 4,251ms (18.7%)  ‚Üê –ù–∞–π–≥—ñ—Ä—à–∏–π!
2. MyPlugin.onMove() - 4,372ms (8.7%)
3. ChunkRegion.tick() - 3,100ms (7.2%)
4. Pathfinder.compute() - 2,890ms (6.1%)
5. WorldServer.doTick() - 2,100ms (4.8%)
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
- –®–≤–∏–¥–∫–æ –∑–Ω–∞–π—Ç–∏ –Ω–∞–π–≥—ñ—Ä—à–æ–≥–æ "–∑–ª–æ—á–∏–Ω—Ü—è"
- –ü–æ–±–∞—á–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –∫–ª–∞—Å–∏/–º–µ—Ç–æ–¥–∏
- –ó—Ä–æ–∑—É–º—ñ—Ç–∏ –¥–µ –∫–æ–ø–∞—Ç–∏ –≥–ª–∏–±—à–µ

### –†–æ–∑–¥—ñ–ª 4: Threads (–ø–æ—Ç–æ–∫–∏)

```
Main Thread - 87% CPU
Worker-1 - 8% CPU
Worker-2 - 5% CPU
```

**–ù–æ—Ä–º–∞:**
- Main Thread 50-70% = –û–ö
- Main Thread >85% = –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- Worker threads <10% = –Ω–æ—Ä–º–∞–ª—å–Ω–æ

## üéØ –ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π –∫–µ–π—Å: –∑–Ω–∞–π—Ç–∏ –ª–∞–≥

### –°–∏—Ç—É–∞—Ü—ñ—è:
```
–°–∫–∞—Ä–≥–∏ –≥—Ä–∞–≤—Ü—ñ–≤: "–°–µ—Ä–≤–µ—Ä –ª–∞–≥–∞—î!"
/tps –ø–æ–∫–∞–∑—É—î: 17.2, 17.8, 18.1
```

### –ö—Ä–æ–∫ 1: Health Report

```bash
/spark healthreport
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Average TPS: 17.6
Worst tick: 185ms (—Ç—ñ–∫ #45231)
CPU: 92%
Memory: 12GB / 16GB (OK)
```

**–í–∏—Å–Ω–æ–≤–æ–∫:** TPS –ø–æ–≥–∞–Ω–æ, CPU –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π, –ø–∞–º—è—Ç—ñ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ.

### –ö—Ä–æ–∫ 2: Profiler –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º

```bash
# –ü–æ—á–µ–∫–∞—Ç–∏ –∫–æ–ª–∏ –≥—Ä–∞–≤—Ü—ñ –æ–Ω–ª–∞–π–Ω (–ø—ñ–∫)
/spark profiler --timeout 300

# –ì—Ä–∞—Ç–∏ 5 —Ö–≤–∏–ª–∏–Ω, –ø–æ—Ç—ñ–º:
/spark profiler --stop
```

### –ö—Ä–æ–∫ 3: –ê–Ω–∞–ª—ñ–∑ –∑–≤—ñ—Ç—É

**–í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è:**

```
Entity Tick: 52.3% ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
‚îú‚îÄ minecraft:item: 22.1% ‚Üê –ë–ê–ì–ê–¢–û –ü–†–ï–î–ú–ï–¢–Ü–í!
‚îú‚îÄ minecraft:cow: 15.8%
‚îî‚îÄ minecraft:zombie: 10.2%

MyShopPlugin: 18.7% ‚Üê –î–£–ñ–ï –ë–ê–ì–ê–¢–û!
‚îî‚îÄ InventoryClickEvent: 16.3% ‚Üê –¢–£–¢ –õ–ê–ì!
```

### –ö—Ä–æ–∫ 4: –†—ñ—à–µ–Ω–Ω—è

**–ü—Ä–æ–±–ª–µ–º–∞ 1: Entities 52.3%**

```bash
/paper entity list

–†–µ–∑—É–ª—å—Ç–∞—Ç:
world: 18,452 entities
‚îú‚îÄ minecraft:item: 8,234 ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
‚îî‚îÄ minecraft:cow: 3,567 ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
```

**–§—ñ–∫—Å:**
```yaml
# spigot.yml
item-despawn-rate: 2400  # –ë—É–ª–æ 6000
merge-radius:
  item: 4.0  # –û–±''—î–¥–Ω—É–≤–∞—Ç–∏ –ø—Ä–µ–¥–º–µ—Ç–∏
```

**–ü—Ä–æ–±–ª–µ–º–∞ 2: MyShopPlugin 18.7%**

**–§—ñ–∫—Å:**
- –û–Ω–æ–≤–∏—Ç–∏ –ø–ª–∞–≥—ñ–Ω –¥–æ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó
- –ê–±–æ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ EssentialsX Shop (–ª–µ–≥—à–∏–π)
- –ù–∞–ø–∏—Å–∞—Ç–∏ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É

### –ö—Ä–æ–∫ 5: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ—Å–ª—è —Ñ—ñ–∫—Å—É

```bash
# –ß–µ—Ä–µ–∑ 30 —Ö–≤–∏–ª–∏–Ω –ø—ñ—Å–ª—è –∑–º—ñ–Ω
/spark profiler --timeout 180
/spark profiler --stop
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Entity Tick: 28.3% ‚úÖ (–±—É–ª–æ 52%)
MyShopPlugin: 8.2% ‚úÖ (–±—É–ª–æ 18.7%)

Average TPS: 19.7 ‚úÖ (–±—É–ª–æ 17.6)
```

**–£—Å–ø—ñ—Ö!** TPS –ø—ñ–¥–Ω—è–≤—Å—è –∑ 17.6 –¥–æ 19.7!

## üìà Timings vs Spark

### Timings (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π)

```bash
/timings on
# –ß–µ–∫–∞—Ç–∏ 10 —Ö–≤–∏–ª–∏–Ω
/timings paste
```

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –í–±—É–¥–æ–≤–∞–Ω–∏–π –≤ Paper/Spigot
- ‚úÖ –ü—Ä–æ—Å—Ç–∏–π

**–ù–µ–¥–æ–ª—ñ–∫–∏:**
- ‚ùå –ú–µ–Ω—à —Ç–æ—á–Ω–∏–π
- ‚ùå –ó–∞—Å—Ç–∞—Ä—ñ–ª–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚ùå –í–∞–∂–∫–æ —á–∏—Ç–∞—Ç–∏
- ‚ùå –ù–µ –ø–æ–∫–∞–∑—É—î –ø–∞–º—è—Ç—ñ

**–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**
- –Ø–∫—â–æ Spark –Ω–µ –ø—Ä–∞—Ü—é—î
- –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞

### Spark (—Å—É—á–∞—Å–Ω–∏–π) ‚≠ê

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –¢–æ—á–Ω—ñ—à–∏–π
- ‚úÖ –ö—Ä–∞—Å–∏–≤–∏–π –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ü–æ–∫–∞–∑—É—î –ø–∞–º—è—Ç—ñ —Ç–∞ GC
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ñ –≥—Ä–∞—Ñ—ñ–∫–∏
- ‚úÖ –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö
- ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è

**–ù–µ–¥–æ–ª—ñ–∫–∏:**
- –¢—Ä–µ–±–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ (5 —Å–µ–∫—É–Ω–¥)

**–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ó–ê–í–ñ–î–ò!**

## üõ†Ô∏è –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–æ–º–∞–Ω–¥–∏ Spark

### Memory (–ø–∞–º—è—Ç—ñ)

```bash
/spark gc
# –í–∏–∫–ª–∏–∫–∞—Ç–∏ Garbage Collection

/spark gcmonitor
# –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ GC –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

/spark heapsummary
# –î–µ—Ç–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ heap –ø–∞–º—è—Ç—ñ
```

### Tickmonitor

```bash
/spark tickmonitor
# –ü–æ–∫–∞–∑—É—î —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–≥–æ —Ç—ñ–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

# –í–∏–≤—ñ–¥:
Tick #1234: 45ms ‚úÖ
Tick #1235: 78ms ‚ö†Ô∏è (+33ms spike!)
Tick #1236: 52ms ‚úÖ
Tick #1237: 156ms ‚ùå (FREEZE!)
```

**–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:**
- –ó–Ω–∞–π—Ç–∏ –ö–û–õ–ò –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –ª–∞–≥–∏
- –ö–æ—Ä–µ–ª—é–≤–∞—Ç–∏ –∑ –¥—ñ—è–º–∏ –≥—Ä–∞–≤—Ü—ñ–≤
- –í–∏—è–≤–∏—Ç–∏ spike patterns

### Sampler –¥–ª—è –ø–ª–∞–≥—ñ–Ω—ñ–≤

```bash
/spark sampler --only-ticks-over 50
# –ó–∞–ø–∏—Å—É–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Ç—ñ–∫–∏ >50ms

/spark sampler --thread main
# –¢—ñ–ª—å–∫–∏ –≥–æ–ª–æ–≤–Ω–∏–π –ø–æ—Ç—ñ–∫

/spark sampler --plugin MyPlugin
# –¢—ñ–ª—å–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –ø–ª–∞–≥—ñ–Ω
```

## üéì –ß–µ–∫-–ª–∏—Å—Ç: —â–æ–¥–µ–Ω–Ω–∏–π –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –†–∞–Ω–æ–∫ (5 —Ö–≤–∏–ª–∏–Ω):

```bash
1. /spark tps
   ‚Üí –ó–∞–ø–∏—Å–∞—Ç–∏ —Å–µ—Ä–µ–¥–Ω—ñ–π TPS

2. /spark healthreport
   ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ CPU —Ç–∞ –ø–∞–º—è—Ç—ñ
   ‚Üí –ó–±–µ—Ä–µ–≥—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è

3. /paper entity list
   ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å entities
```

### –ü—Ä–∏ —Å–∫–∞—Ä–≥–∞—Ö –Ω–∞ –ª–∞–≥–∏:

```bash
1. /spark tps
   ‚Üí –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É

2. /spark tickmonitor
   ‚Üí –ü–æ–±–∞—á–∏—Ç–∏ spike –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

3. /spark profiler --timeout 300
   ‚Üí –ó–∞–ø–∏—Å–∞—Ç–∏ 5 —Ö–≤–∏–ª–∏–Ω
   
4. /spark profiler --stop
   ‚Üí –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç
   
5. –ó–∞—Ñ—ñ–∫—Å–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É
   
6. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä–≤–µ—Ä
   
7. /spark profiler —â–µ —Ä–∞–∑
   ‚Üí –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ —Ñ—ñ–∫—Å —Å–ø—Ä–∞—Ü—é–≤–∞–≤
```

### –©–æ—Ç–∏–∂–Ω—è:

```bash
1. /spark profiler –ø—ñ–¥ –ø—ñ–∫–æ–≤–∏–º –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
2. –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–≤—ñ—Ç
3. –ü–æ—Ä—ñ–≤–Ω—è—Ç–∏ –∑ –º–∏–Ω—É–ª–∏–º —Ç–∏–∂–Ω–µ–º
4. –®—É–∫–∞—Ç–∏ —Ç—Ä–µ–Ω–¥–∏ (–ø–æ–≥—ñ—Ä—à–µ–Ω–Ω—è/–ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è)
```

## üí° –ü–æ—Ä–∞–¥–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª–∞

### 1. –ó–∞–≤–∂–¥–∏ –ø—Ä–æ—Ñ–∞–π–ª—ñ—Ç—å –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
```
‚ùå 0 –≥—Ä–∞–≤—Ü—ñ–≤ –æ–Ω–ª–∞–π–Ω = –Ω–µ—Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–æ
‚úÖ 50+ –≥—Ä–∞–≤—Ü—ñ–≤ –æ–Ω–ª–∞–π–Ω = —Ä–µ–∞–ª—å–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∞
```

### 2. –ü–æ—Ä—ñ–≤–Ω—é–π—Ç–µ –¥–æ/–ø—ñ—Å–ª—è
```bash
# –î–û –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
/spark profiler

# –†–æ–±–∏–º–æ –∑–º—ñ–Ω–∏

# –ü–Ü–°–õ–Ø –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó  
/spark profiler

# –ü–æ—Ä—ñ–≤–Ω—è—Ç–∏ –≤—ñ–¥—Å–æ—Ç–∫–∏
```

### 3. –®—É–∫–∞–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∏
```
–Ø–∫—â–æ Entity Tick >30% ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –∑ –º–æ–±–∞–º–∏
–Ø–∫—â–æ Chunk Tick >20% ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –∑ —Å–≤—ñ—Ç–æ–º
–Ø–∫—â–æ Plugin >15% ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –∑ –ø–ª–∞–≥—ñ–Ω–æ–º
```

### 4. –û–¥–∏–Ω —Ñ—ñ–∫—Å –∑–∞ —Ä–∞–∑
```
‚ùå –ó–º—ñ–Ω–∏—Ç–∏ 10 —Ä–µ—á–µ–π ‚Üí –Ω–µ –∑–Ω–∞—î—Ç–µ —â–æ —Å–ø—Ä–∞—Ü—é–≤–∞–ª–æ
‚úÖ –ó–º—ñ–Ω–∏—Ç–∏ 1 —Ä—ñ—á ‚Üí –ø—Ä–æ—Ñ–∞–π–ª ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ ‚Üí –Ω–∞—Å—Ç—É–ø–Ω–∞
```

### 5. –ó–±–µ—Ä beg–∞–ª—ñ—Ç—å –∑–≤—ñ—Ç–∏
```
–°—Ç–≤–æ—Ä—ñ—Ç—å –ø–∞–ø–∫—É spark_reports/
–ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ –¥–∞—Ç–∞–º–∏
–ü–æ—Ä—ñ–≤–Ω—é–π—Ç–µ —ñ—Å—Ç–æ—Ä—ñ—é –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
```

## üîë –ö–ª—é—á–æ–≤—ñ –≤–∏—Å–Ω–æ–≤–∫–∏

1. **Spark - –æ–±–æ–≤''—è–∑–∫–æ–≤–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** –¥–ª—è –±—É–¥—å-—è–∫–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
2. **–ü—Ä–æ—Ñ–∞–π–ª—ñ—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ** - –º—ñ–Ω—ñ–º—É–º —Ä–∞–∑ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å
3. **–ó–∞–ø–∏—Å—É–π—Ç–µ –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º** - —ñ–Ω–∞–∫—à–µ –Ω–µ—Ä–µ–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ç–∏–≤–Ω–æ
4. **–®—É–∫–∞–π—Ç–µ >15%** - –≤—Å–µ —â–æ –∑–∞–π–º–∞—î –±—ñ–ª—å—à–µ = –ø—Ä–æ–±–ª–µ–º–∞
5. **–ü–æ—Ä—ñ–≤–Ω—é–π—Ç–µ –¥–æ/–ø—ñ—Å–ª—è** - —î–¥–∏–Ω–∏–π —Å–ø–æ—Å—ñ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—ñ–∫—Å

## üìö –î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Spark –Ω–∞ —Å–≤—ñ–π —Å–µ—Ä–≤–µ—Ä
2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å `/spark healthreport` - –∑–±–µ—Ä–µ–∂—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è
3. –ó—Ä–æ–±—ñ—Ç—å `/spark profiler` –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω –ø—ñ–¥ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º
4. –ó–Ω–∞–π–¥—ñ—Ç—å –¢–û–ü-3 –Ω–∞–π–≥—ñ—Ä—à—ñ—à—ñ –º–µ—Ç–æ–¥–∏ —É –∑–≤—ñ—Ç—ñ
5. –ó–∞–ø–∏—à—ñ—Ç—å —ó—Ö —Ç–∞ % —á–∞—Å—É

**–ü—ñ–¥–≥–æ—Ç—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —É—Ä–æ–∫—É** - –º–∏ –±—É–¥–µ–º–æ —Ñ—ñ–∫—Å–∏—Ç–∏ —Ü—ñ –ø—Ä–æ–±–ª–µ–º–∏!

---

**–ù–∞—Å—Ç—É–ø–Ω–∏–π —É—Ä–æ–∫:** –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–∏—á–∏–Ω–∏ –ª–∞–≥—ñ–≤ —Ç–∞ —è–∫ —ó—Ö —É—Å—É–Ω—É—Ç–∏',
    2400,
    2,
    false
  );

  RAISE NOTICE 'Lesson 2 created!';
END $$;

SELECT l.title, l.order_index, l.duration
FROM course_lessons l
JOIN course_modules m ON m.id::text = l.module_id
WHERE m.course_id = 'paid-2' AND m.order_index = 1
ORDER BY l.order_index;
